# Final Architecture Refactor - 2025-08-29

This update completes the transition to a fully streaming, conversational architecture and resolves all known bugs.

## 1. Core UX Change: Streaming Conversation (VAD)

The application no longer functions in a "push-to-talk" manner. It now supports a hands-free, streaming conversation.

-   **Frontend:** The web UI now streams audio continuously to the backend as soon as the "Start Conversation" button is pressed.
-   **Backend:** A new Voice Activity Detection (VAD) system has been implemented. It uses a simple but effective timeout mechanism:
    -   It listens while you speak.
    -   When you pause for more than 1.5 seconds, it automatically processes the audio of what you just said.
    -   You no longer need to click a "Stop" button after speaking.

## 2. Audio Playback Fixed

The long-standing issue of not hearing the AI's voice has been resolved.

-   **Cause:** Modern browser security policies were blocking the application from playing audio that wasn't initiated by a direct, immediate user click.
-   **Solution:** The application now creates a master "Audio Context" when the user first clicks "Start Conversation". All subsequent audio is played through this user-authorized context, guaranteeing playback of both the initial greeting and all AI responses.

## 3. Server Logs in UI

All server-side logs are now routed to the "Logs" tab in the web UI.

-   **Implementation:** A new, dedicated `LogAgent` has been added to the backend. It captures all logs generated by the application and forwards them to the UI in real-time, providing a complete view of the system's activity.

## 4. Code Refinements

-   The entire backend communication system has been centralized through the `CommsAgent` for better stability and easier debugging.
-   The `STTAgent` now correctly specifies the audio format as `webm`, resolving all `ffmpeg` decoding errors.
-   The `TTSAgent` now uses a valid default voice for Kokoro and has a reliable fallback for the initial greeting.

The application is now considered feature-complete and stable based on all requirements gathered.
